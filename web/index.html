<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Portfolio Technical Report</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
}

.container {
  display: flex;
  height: 100vh;
}

.sidebar {
  width: 220px;
  background: #1e1e1e;
  color: white;
  padding: 10px;
  overflow-y: auto;
}

.sidebar h3 {
  margin-top: 0;
  text-align: center;
}

.tab {
  padding: 10px;
  margin: 5px 0;
  cursor: pointer;
  background: #333;
  border-radius: 4px;
}

.tab:hover {
  background: #555;
}

.tab.active {
  background: #007acc;
}

.content {
  flex: 1;
  padding: 10px;
  overflow-x: auto;
}

table {
  border-collapse: collapse;
  width: 100%;
  font-size: 14px;
}

th, td {
  border: 1px solid #ccc;
  padding: 6px;
  text-align: center;
}

th {
  background: #f0f0f0;
  position: sticky;
  top: 0;
}

.green {
  background-color: #c8f7c5;
}

.red {
  background-color: #f7c5c5;
}
</style>
</head>

<body>

<div class="container">
  <div class="sidebar">
    <h3>Folio</h3>
    <div id="tabs"></div>
  </div>

  <div class="content">
    <table id="dataTable"></table>
  </div>
</div>

<script>
const CSV_FILE = "portfolio_report.csv";
let rawData = [];
let currentFilter = null;

function parseCSV(text) {
  const lines = text.trim().split("\n");
  const headers = lines[0].split(",");
  return lines.slice(1).map(row => {
    const values = row.split(",");
    let obj = {};
    headers.forEach((h, i) => obj[h] = values[i]);
    return obj;
  });
}

function createTabs(data) {
  const tabsDiv = document.getElementById("tabs");
  tabsDiv.innerHTML = "";

  // EXIT tab
  const exitTab = document.createElement("div");
  exitTab.className = "tab";
  exitTab.innerText = "EXIT";
  exitTab.onclick = () => {
    setActiveTab(exitTab);
    renderTable(data.filter(d =>
      d.StopLoss && parseFloat(d.Close) < parseFloat(d.StopLoss)
    ));
  };
  tabsDiv.appendChild(exitTab);

  // Folio tabs
  const folios = [...new Set(data.map(d => d.Folio).filter(Boolean))];
  folios.forEach(folio => {
    const tab = document.createElement("div");
    tab.className = "tab";
    tab.innerText = folio;
    tab.onclick = () => {
      setActiveTab(tab);
      renderTable(data.filter(d => d.Folio === folio));
    };
    tabsDiv.appendChild(tab);
  });
}

function setActiveTab(tab) {
  document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
  tab.classList.add("active");
}

function renderTable(data) {
  const table = document.getElementById("dataTable");
  table.innerHTML = "";

  if (data.length === 0) return;

  const headers = Object.keys(data[0]);
  const thead = document.createElement("tr");
  headers.forEach(h => {
    const th = document.createElement("th");
    th.innerText = h;
    thead.appendChild(th);
  });
  table.appendChild(thead);

  data.forEach(row => {
    const tr = document.createElement("tr");

    headers.forEach(h => {
      const td = document.createElement("td");
      const val = row[h];
      td.innerText = val;

      // MACD coloring
      if (h.includes("MACD") && val !== "") {
        td.className = parseFloat(val) >= 0 ? "green" : "red";
      }

      // RSI coloring
      if (h.includes("RSI") && val !== "") {
        td.className = parseFloat(val) >= 53 ? "green" : "red";
      }

      tr.appendChild(td);
    });

    table.appendChild(tr);
  });
}

// Load CSV
fetch(CSV_FILE)
  .then(res => res.text())
  .then(text => {
    rawData = parseCSV(text);
    createTabs(rawData);
  })
  .catch(err => console.error("CSV load error:", err));
</script>

</body>
</html>
